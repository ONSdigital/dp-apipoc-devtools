def process

task acceptanceTest(type: Test) {
    include '**/*AcceptanceTest.*'

    //http://issues.gradle.org/browse/GRADLE-1254
    finalizedBy 'tearDown'

    doFirst {
        println 'Starting anthill ...'
        process = new ProcessBuilder().inheritIO()
                .command("./StartAnthill.sh")
                .start()
    }

    beforeTest { descriptor ->
        logger.lifecycle("Running test: " + descriptor)
    }
    onOutput { descriptor, event ->
        logger.lifecycle("Test: " + descriptor + ":" + event.message)
    }
}

task tearDown {
    doLast{
        println 'finalize'
        process.destroy()

        new ProcessBuilder().inheritIO()
                .command("./StopAnthill.sh")
                .start()
    }
}

task publishTest(type: GradleBuild) {
    tasks = ['acceptanceTest', 'aggregate']
}